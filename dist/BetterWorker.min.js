!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).BetterWorker=e()}(this,function(){"use strict";var r=(t.createzThread=function(t){return new Promise(function(n,e){window.fetch(t).then(function(t){return t.text()}).then(function(t){var e=new window.Worker(window.URL.createObjectURL(new window.Blob([t])));n(e)}).then(function(t){e(t)})})},t);function t(){}var e=(n.prototype.disPatcherTask=function(t,e,n,o){this.taskQueue.push({index:t,method:e,param:n,listener:o}),this.allWorkerReady&&this.doTask()},n.prototype.doTask=function(){for(var t=0,e=this.taskQueue.length;t<e;t+=1){var n=this.taskQueue.shift(),o=n.index,i=n.method,s=n.param,a=n.listener,r=this.thread.get(o),h={index:o,method:i,param:s};this.taskCb.set(""+o+i+s,a),r.postMessage(h)}},n.prototype.init=function(){for(var n=this,o=this,i=0,t=function(e,t){r.createzThread(s.wps[e]).then(function(t){o.thread.set(e,t),t.onmessage=o.doTaskListener.bind(n),(i+=1)===o.wps.length&&(o.allWorkerReady=!0,n.doTask())}).catch(function(t){console.error(t)})},s=this,e=0,a=this.wps.length;e<a;e+=1)t(e)},n.prototype.doTaskListener=function(t){var e=t.data.index,n=t.data.param,o=t.data.method,i=t.data.res,s=this.taskCb.get(""+e+o+n);console.log(""+e+o+n,t,this.taskCb,s),s(i)},n);function n(t){this.thread=new Map,this.taskCb=new Map,this.taskQueue=[],this.allWorkerReady=!1,this.wps=t,this.init()}function o(t){this.tm=new e(t)}return o.prototype.doTask=function(t,e,n,o){this.tm.disPatcherTask(t,e,n,o)},o});
