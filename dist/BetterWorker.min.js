!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).BetterWorker=e()}(this,function(){"use strict";var r=(t.createzThread=function(t){return new Promise(function(n,e){window.fetch(t).then(function(t){return t.text()}).then(function(t){t+="onmessage = function(e) {\n  const index = e.data.index;\n  const method = e.data.method;\n  const param = e.data.param;\n  eval(method)(param).then((res) => {\n    postMessage({\n      index,\n      method,\n      param,\n      res\n    })\n  }).catch((error) => {\n    postMessage(error);\n  })\n}";var e=new window.Worker(window.URL.createObjectURL(new window.Blob([t])));n(e)}).then(function(t){e(t)})})},t);function t(){}var e=(n.prototype.disPatcherTask=function(t,e,n,a){this.taskQueue.push({index:t,method:e,param:n,listener:a}),this.allWorkerReady&&this.doTask()},n.prototype.doTask=function(){for(var t=0,e=this.taskQueue.length;t<e;t+=1){var n=this.taskQueue.shift(),a=n.index,o=n.method,s=n.param,i=n.listener,r=this.thread.get(a),d={index:a,method:o,param:s};this.taskCb.set(""+a+o+s,i),r.postMessage(d)}},n.prototype.init=function(){for(var n=this,a=this,o=0,t=function(e,t){r.createzThread(s.wps[e]).then(function(t){a.thread.set(e,t),t.onmessage=a.doTaskListener.bind(n),(o+=1)===a.wps.length&&(a.allWorkerReady=!0,n.doTask())}).catch(function(t){console.error(t)})},s=this,e=0,i=this.wps.length;e<i;e+=1)t(e)},n.prototype.doTaskListener=function(t){var e=t.data.index,n=t.data.param,a=t.data.method,o=t.data.res;this.taskCb.get(""+e+a+n)(o)},n);function n(t){this.thread=new Map,this.taskCb=new Map,this.taskQueue=[],this.allWorkerReady=!1,this.wps=t,this.init()}function a(t){this.tm=new e(t)}return a.prototype.doTask=function(t,e,n,a){this.tm.disPatcherTask(t,e,n,a)},a});
